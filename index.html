<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Arco Blog</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']], // Cho phép viết toán giữa hai dấu $
            displayMath: [['$$', '$$'], ['\\[', '\\]']] // Cho phép viết toán dạng khối giữa $$
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<body>

    <header>
        <div class="header-container">
            <div class="logo">
                <img src="https://hostrider.com/images/tw.png" alt="C++ Basic">
            </div>
            <nav>
                <a href="index.html">Homepage</a>
                <a href="index_docs.html">Document</a>
                <a href="https://cppbasic.contest.codeforces.com">Judge</a>
            </nav>
        </div>
    </header>

    <main id="main-content">
        <div id="post-list" class="hidden">
            <h2 class="section-title">News</h2>
            <ul id="list-container">
                <li class="loading">Loading...</li>
            </ul>
        </div>

        <article id="post-content" class="hidden post-detail"></article>
    </main>

    <footer>
        <p>Pixel Arco</p>
    </footer>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const postName = urlParams.get('post');
        const postList = document.getElementById('post-list');
        const postContent = document.getElementById('post-content');
        const listContainer = document.getElementById('list-container');

        if (postName) {
            // HIỂN THỊ BÀI VIẾT CHI TIẾT
            postContent.classList.remove('hidden');
            fetch(`./content/${postName}.md`)
                .then(res => {
                    if(!res.ok) throw new Error();
                    return res.text();
                }) 
                .then(md => {
                    postContent.innerHTML = marked.parse(md);

                    // Thêm dòng này để MathJax xử lý lại các công thức toán vừa được chèn vào
                    if (window.MathJax) {
                        MathJax.typesetPromise();
                    }

                    // Thêm dòng này để tô màu lại code
                    if (window.Prism) {
                        Prism.highlightAllUnder(postContent);
                    }
                })
                .catch(() => {
                    postContent.innerHTML = "<h2>404</h2><p>404 - Post not found.</p>";
                });
        } else {
            // HIỂN THỊ TRANG CHỦ
            postList.classList.remove('hidden');
            fetch('./posts.json')
                .then(res => res.json())
                .then(posts => {
                    if (posts.length === 0) {
                        listContainer.innerHTML = "<li>No post.</li>";
                        return;
                    }
                    listContainer.innerHTML = posts.map(post => `
                        <li>
                            <a href="?post=${post.slug}">${post.title}</a>
                        </li>
                    `).join('');
                })
                .catch(() => {
                    listContainer.innerHTML = "<li>Loading Error.</li>";
                });
        }
    </script>
</body>
</html>